{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% endblock %} | ChatBot UI</title>
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    {% block styles %}
    {% endblock %}
</head>
<body>
    <div id="loader-overlay">
        <div class="indicator-box">
            <div class="loading-ring"></div>
            <p>Cargando...</p>
        </div>
    </li>
    </div>
    {% include 'includes/header.html' %}
    <div class="page">
        <div id="page-wrapper">
            {% block content %}
            {% endblock %}
        </div>
    </div>
    <script>
        const loadingRing = document.getElementById("loader-overlay");
        function showLoader(message){
            loadingRing.querySelector('p').innerHTML = message;
            loadingRing.style.display = 'flex';
        }
        function hideLoader(){
            loadingRing.style.display = 'none';
        }
    </script>
    <script>
        const trainbtn = document.getElementById("trainModelBtn");
        const trainMessageContainer = document.getElementById("traininMessage");

        trainbtn.addEventListener("click",event => {
            showLoader("Re-entrenando modelo...")
            fetch (
                "{% url 'chatbot_train' %}",
                {
                    credentials:"same-origin",
                    method: 'POST',
                    headers: { "X-CSRFToken": "{{ csrf_token }}" },
                }
            ).then(response => {
                if (response.status == 200) {
                    hideLoader();
                    response.json().then(jsonResponse => {
                        trainMessageContainer.style.display = 'block';
                        trainMessageContainer.innerHTML = jsonResponse.message;
                    });
                } else if (response.status == 400 || response.status == 500){
                    hideLoader();
                    response.json().then(jsonResponse => {
                        trainMessageContainer.style.display = 'block';
                        trainMessageContainer.innerHTML = jsonResponse.message;
                    });
                } else {
                    hideLoader();
                    response.json().then(jsonResponse => {
                        trainMessageContainer.style.display = 'block';
                        trainMessageContainer.innerHTML = "Algo extraño sucedió, intentalo más tarde.";
                    });
                }
            }).catch(err => {
                hideLoader();
                trainMessageContainer.style.display = 'block';
                trainMessageContainer.innerHTML = "Verifica tu conexion a internet.";
            });
        });
    </script>

    {% block scripts %}
    {% endblock %}
</body>
</html>